= Home Assistant
Thomas Stütz
1.0.0, {docdate}
ifndef::imagesdir[:imagesdir: images]
:icons: font
:sectnums:    // Nummerierung der Überschriften / section numbering
:toc:
:toclevels: 3
:experimental:
//https://gist.github.com/dcode/0cfbf2699a1fe9b46ff04c41721dda74?permalink_comment_id=3948218
ifdef::env-github[]
:tip-caption: :bulb:
:note-caption: :information_source:
:important-caption: :heavy_exclamation_mark:
:caution-caption: :fire:
:warning-caption: :warning:
endif::[]

== HassOS installieren

* https://wiki.odroid.com/getting_started/petitboot/os_installation_using_otg#petitboot_setup_odroid[Petitboot setup(ODROID)^]
* https://magazine.odroid.com/article/os-installation-using-petitboot-and-usb-otg/[OS Installation using Petitboot and USB OTG^]
* https://www.home-assistant.io/common-tasks/os#flashing-an-odroid-n2[Flashing an ODROID-N2+^]

//--

=== Odroid mit petitboot starten

* connect ethernet, keyboard and hdmi
* Taster auf SPI umschalten (links)
* Odroid mit Netzgerät einschalten

IMPORTANT: Niemals das emmc-Modul entfernen oder einstecken, wenn der odroid eingeschalten ist. Es könnte ein Hardware Defekt auftreten.

image::N2-OS-installation-using-Petitboot-figure-1.jpg[]


image::exit-to-shell.png[]


* Exit to shell

image::N2-OS-installation-using-Petitboot-figure-2.jpg[]

* Den Odroid in den *USB mass storage mode* versetzen

----
ls /dev/mmc*
ums /dev/mmcblk0
----

* USB-Kabel anschließen

image::N2-OS-installation-using-Petitboot-figure-4.jpg[]

=== emmc flashen

.Etcher
[%collapsible]
====

image::etcher-01.png[]
image::etcher-02.png[]
image::etcher-03.png[]
image::etcher-04.png[]
image::etcher-05.png[]
image::etcher-06.png[]
image::etcher-07.png[]


====

* USB-Kabel entfernen

* Stromversorgung am odroid n2+ entfernen

* Schalter von SPI auf MMC umschalten (von oben gesehen: auf rechts)

== Erster Start von Home Assistant

image::ha-onboarding-screen.png[]

image::ha-onboarding-screen-2.png[]

.additional screens
[%collapsible]
====

image::ha-onboarding-screen-3.png[]

image::ha-onboarding-screen-4.png[]

====

image::ha-start-screen.png[]

=== Sprache Deutsch einstellen

* Falls noch nicht deutsch:
** Settings - System - General - Language -> Deutsch
** kbd:[UPDATE]
** Ev. im Browser die bevorzugte Sprache einstellen


=== Erweiterten Modus einstellen

Profil - Erweiterter Modus: ein


== Add-Ons

=== Add-On Store

image::ha-add-ons-1.png[]

image::ha-add-ons-2.png[]

image::ha-add-ons-3.png[]



=== SSH/SFTP

image::addon-ssh-web-terminal.png[]

image::addon-ssh-web-terminal-2.png[]

image::addon-ssh-web-terminal-3.png[]

==== Password setzen

image::addon-ssh-web-terminal-4.png[]

.Für sftp muss der username root sein
image::addon-ssh-web-terminal-5.png[]


* kbd:[SPEICHERN]

* Entwicklerwerkzeuge - kbd:[NEU STARTEN]

==== Fehlermeldungen

image::addon-ssh-web-terminal-6.png[]

.Terminal ausprobieren
image::addon-ssh-web-terminal-7.png[]

.Fehlerlog ist jetzt auch ok
image::addon-ssh-web-terminal-8.png[]

==== SFTP testen

image::addon-ssh-web-terminal-9.png[]

=== Home Assistant Community Store (HACS)

* https://hacs.xyz/docs/setup/download/

image::addon-hacs-1.png[]

image::addon-hacs-2.png[]

* Entwicklerwerkzeuge - kbd:[NEU STARTEN]

* Cache leeren

image::addon-hacs-3.png[]

* Einstellungen - Geräte und Dienste - kbd:[INTEGRATION HINZUFÜGEN]

* "HACS" im Suchfeld eingeben

image::addon-hacs-4.png[]

image::addon-hacs-5.png[]

image::addon-hacs-6.png[]

image::addon-hacs-7.png[]

image::addon-hacs-8.png[]

image::addon-hacs-9.png[]

=== Visual Studio Code

* Nachdem nun der HACS installiert wurde, können wir ihn auch benutzen.

* HACS - Add-ons - kbd:[GO NOW] - kbd:[ADD-ON STORE]

image::addon-vscode-1.png[]

image::addon-vscode-2.png[]

* kbd:[INSTALLIEREN]

image::addon-vscode-3.png[]

image::addon-vscode-4.png[]

* alle Optionen aktivieren

* kbd:[STARTEN]

.Hier kann man die config-dateien editieren
image::addon-vscode-5.png[]

=== Samba share

* Einstellungen - Add-ons - kbd:[ADD-ON STORE]

image::addon-samba-01.png[]

image::addon-samba-02.png[]

* kbd:[INSTALL]

image::addon-samba-03.png[]

* kbd:[START]

image::addon-samba-04.png[]

* Entwicklerwerkzeuge - kbd:[NEU STARTEN]

image::addon-samba-05.png[]

image::addon-samba-06.png[]

image::addon-samba-07.png[]



[%collapsible]
====
[source,yaml]
----
username: leo
password: passme
workgroup: WORKGROUP
compatibility_mode: false
veto_files:
  - ._*
  - .DS_Store
  - Thumbs.db
  - icon?
  - .Trashes
allow_hosts:
  - 10.0.0.0/8
  - 172.16.0.0/12
  - 192.168.0.0/16
  - fe80::/10
----
====

* kbd:[SPEICHERN]

* Tab "Informationen"

* kbd:[STARTEN]

image::addon-samba-08.png[]

==== Samba testen

image::addon-samba-13.png[]

[%collapsible]
====

image::addon-samba-09.png[]

image::addon-samba-10.png[]

image::addon-samba-11.png[]

image::addon-samba-12.png[]

====




=== mosquitto broker

* Einstellungen - Add-ons - kbd:[ADD-ON STORE]

image::addon-mqtt-1.png[]

image::addon-mqtt-2.png[]

* kbd:[INSTALLIEREN]

image::addon-mqtt-3.png[]

* Entwicklerwerkzeuge - kbd:[NEU STARTEN]

* Einstellungen - Add-ons - Mosquitto broker

image::addon-mqtt-4.png[]

* Tab "Konfiguration" - Hamburger - Als YAML bearbeiten

.KEINE User anlegen (logins)
[source,yaml]
----
logins: []
require_certificate: false
certfile: fullchain.pem
keyfile: privkey.pem
customize:
  active: false
  folder: mosquitto
----

==== mqtt testen

image::addon-mqtt-5.png[]

image::addon-mqtt-6.png[]


=== EspHome

* Einstellungen - Add-ons - kbd:[ADD-ON STORE]

* ESPHome

image::addon-esphome-1.png[]


* kbd:[INSTALLIEREN]

image::addon-esphome-2.png[]

* ein paar Sekunden warten (ev. Log kontrollieren)

image::addon-esphome-3.png[]

image::addon-esphome-4.png[]

=== NodeRed

* Einstellungen - Add-ons - kbd:[ADD-ON STORE]

* Node-Red

image::addon-nodered-1.png[]

* kbd:[INSTALLIEREN]

image::addon-nodered-2.png[]

* kbd:[STARTEN]

image::addon-nodered-3.png[]

* Tab "Konfiguration" - Hamburger - Als YAML bearbeiten

.Original
[source,yaml]
----
certfile: fullchain.pem
credential_secret: ""
http_node:
  password: ""
  username: ""
http_static:
  password: ""
  username: ""
init_commands: []
keyfile: privkey.pem
npm_packages: []
ssl: true
system_packages: []
theme: default
----

.angepaßt
[source,yaml]
----
certfile: fullchain.pem
credential_secret: "passme"
http_node:
  password: ""
  username: ""
http_static:
  password: ""
  username: ""
init_commands: []
keyfile: privkey.pem
npm_packages: []
ssl: false
system_packages: []
theme: default
----

* kbd:[SPEICHERN]
#
* kbd:[NEU STARTEN]

image::addon-nodered-4.png[]

////
=== vsFTPD

[source,yaml]
----
banner: Welcome to the Hass.io FTP service.
certfile: fullchain.pem
data_port: 20
implicit_ssl: false
keyfile: privkey.pem
max_clients: 5
pasv: true
pasv_address: ""
pasv_max_port: 30010
pasv_min_port: 30000
port: 21
ssl: false
users:
  - addons: true
    allow_chmod: true
    allow_dirlist: true
    allow_download: true
    allow_upload: true
    backup: true
    config: true
    media: true
    password: passme
    share: true
    ssl: false
    username: leo
----

////

== Restore eines Backups

=== Neuen User anlegen

image::create-user.png[]







